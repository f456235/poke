{"version":3,"sources":["assets\\script\\man_map3.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAC1C,6CAAwC;AACxC,2CAAsC;AAEtC;IAAiC,uBAAY;IAA7C;QAAA,qEA2OC;QAxOG,gBAAU,GAAgB,IAAI,CAAC;QAG/B,WAAK,GAAa,IAAI,CAAC;QAGvB,aAAO,GAAgB,IAAI,CAAC;QAG5B,UAAI,GAAW,OAAO,CAAC;QAGvB,SAAG,GAAiB,IAAI,CAAC;QAGzB,eAAS,GAAiB,IAAI,CAAC;QAG/B,eAAS,GAAW,CAAC,CAAC,CAAC,gBAAgB;QAEvC,eAAS,GAAE,IAAI,CAAC,CAAC,OAAO;QAEhB,cAAQ,GAAY,KAAK,CAAC;QAE1B,gBAAU,GAAY,KAAK,CAAC;QAC5B,kBAAY,GAAY,KAAK,CAAC;QAC9B,kBAAY,GAAY,KAAK,CAAC;QAC9B,mBAAa,GAAY,KAAK,CAAC;QAC/B,gBAAU,GAAG,CAAC,CAAC;QAChB,cAAQ,GAAG,CAAC,CAAC;;IA2MxB,CAAC;IAxMG,mBAAK,GAAL;QACI,IAAI,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;QAC/D,+CAA+C;QAG/C,gDAAgD;QAChD,6BAA6B;QAC7B,IAAI,WAAW,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACvC,IAAI,KAAK,GAAG,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACvC,IAAI,SAAS,GAAG,KAAK,CAAC,YAAY,EAAE,CAAC;QACrC,IAAI,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACzC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QAC7B,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAC/C,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QACjD,OAAO,CAAC,GAAG,CAAC,aAAa,EAAC,WAAW,CAAC,CAAC;QACvC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAC,SAAS,CAAC,CAAC;QACnC,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,EAAC;YACpC,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAC;gBACrC,IAAI,IAAI,GAAG,SAAS,CAAC,cAAc,CAAC,CAAC,EAAC,CAAC,EAAC,IAAI,CAAC,CAAC;gBAC9C,IAAG,IAAI,CAAC,GAAG,IAAE,CAAC,EAAC;oBACX,wBAAwB;oBACxB,wBAAwB;oBACxB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;oBACzB,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC;oBACtD,QAAQ,CAAC,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,KAAK,GAAC,CAAC,GAAC,GAAG,EAAC,WAAW,CAAC,MAAM,GAAC,CAAC,GAAC,GAAG,CAAC,CAAC;oBAC1E,QAAQ,CAAC,IAAI,GAAG,WAAW,CAAC;oBAC5B,mCAAmC;oBACnC,oCAAoC;iBACvC;aACJ;SACJ;QACD,IAAI,aAAa,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,eAAe,CAAC,CAAC;QAC5D,OAAO,CAAC,GAAG,CAAC,uBAAuB,EAAE,aAAa,CAAC,CAAC;QACpD,uDAAuD;QACvD,0BAA0B;QAC1B,GAAG;QACH,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAC,IAAa;YACtC,kCAAkC;YAClC,6CAA6C;YAC7C,IAAG,oBAAU,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,EAAC;gBAC5C,IAAI,CAAC,OAAO,EAAE,CAAC;aAClB;QACL,CAAC,EAAE;YACC,2EAA2E;YAC3E,oCAAoC;QACxC,CAAC,CAAC,CAAC;QACH,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACzC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;QAC5E,gCAAgC;QAChC,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG,KAAK,CAAC;IAClC,CAAC;IAED,oBAAM,GAAN;QACI,SAAS;QACT,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,IAAI,OAAO,GAAG,EAAE,CAAC,QAAQ,CAAC,mBAAmB,EAAE,CAAC;QAChD,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QACjD,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC3E,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACvE,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,oBAAU,CAAC,UAAU,EAAC,oBAAU,CAAC,UAAU,CAAC,CAAC;QACnE,EAAE,CAAC,QAAQ,CAAC,mBAAmB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QACjD,6DAA6D;IAEjE,CAAC;IAED,uBAAS,GAAT;QACI,WAAW;QACX,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC5E,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IAC5E,CAAC;IAED,2BAAa,GAAb,UAAc,aAAqB;QAC/B,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAC,SAAS,EAAE;YAC7E,OAAO;SACV;QAED,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACvC,CAAC;IAED,2BAAa,GAAb,UAAc,aAAqB;QAC/B,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAC,SAAS,EAAE;YAC7E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SACtC;IACL,CAAC;IAED,uBAAS,GAAT,UAAU,KAA6B;QACnC,QAAO,KAAK,CAAC,OAAO,EAAE;YAClB,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBAChB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;gBACvB,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;gBAClB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;gBAClB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK;gBACnB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;gBAC1B,MAAM;SACb;IACL,CAAC;IAED,qBAAO,GAAP,UAAQ,KAA6B;QACjC,QAAO,KAAK,CAAC,OAAO,EAAE;YAClB,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBAChB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;gBACvB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAC9B,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;gBAClB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;gBACzB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBAChC,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;gBAClB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;gBACzB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBAChC,MAAM;YACV,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK;gBACnB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;gBAC1B,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;gBACjC,MAAM;SACb;IACL,CAAC;IAED,oBAAM,GAAN,UAAO,EAAU;QACb,wHAAwH;QACxH,mDAAmD;QACnD,wCAAwC;QACxC,IAAI;QACJ,mCAAmC;QACnC,eAAe;QACf,IAAG,IAAI,CAAC,UAAU,CAAC,KAAK,IAAE,KAAK,EAC/B;YACI,IAAI,IAAI,CAAC,UAAU,EAAE;gBACrB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,CAAC;gBACjC,IAAG,CAAC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,SAAS;oBAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aAC1F;YACD,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;gBACnC,IAAG,CAAC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC,SAAS;oBAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aAC9F;YACD,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;gBACnC,IAAG,CAAC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC,SAAS;oBAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aAC9F;YACD,IAAI,IAAI,CAAC,aAAa,EAAE;gBACpB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;gBACnC,IAAG,CAAC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC,SAAS;oBAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;aAChG;SACJ;QAED,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,IAAI,KAAK,EAAE;SACnH;QACD,oBAAU,CAAC,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAClD,oBAAU,CAAC,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAClD,EAAE,CAAC,WAAW,CAAC,cAAc,CAAC,oBAAU,CAAC,MAAM,CAAC,CAAC;QACjD,EAAE,CAAC,WAAW,CAAC,gBAAgB,CAAC,oBAAU,CAAC,MAAM,CAAC,CAAC;IACvD,CAAC;IAED,8BAAgB,GAAhB,UAAiB,KAAK,EAAE,IAAI;QACxB,IAAG,KAAK,CAAC,IAAI,CAAC,KAAK,IAAI,MAAM,EAAC;YAC1B,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,CAAC,OAAO;YAClC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,GAAG,GAAC,CAAC,CAAC;SAC/C;IACL,CAAC;IACD,4BAAc,GAAd,UAAe,OAAO,EAAE,YAAY,EAAE,aAAa;QAC/C,iCAAiC;QACjC,IAAI,aAAa,GAAG,OAAO,CAAC,gBAAgB,EAAE,CAAC;QAC/C,IAAI,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;QAClC,IAAI,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;QAClC,IAAG,aAAa,CAAC,GAAG,IAAI,CAAC,IAAI,aAAa,CAAC,GAAG,IAAI,CAAC,IAAI,aAAa,CAAC,GAAG,IAAI,CAAC,IAAG,aAAa,CAAC,GAAG,IAAI,CAAC,EAAC;YACnG,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,GAAG,CAAC;YAClC,iCAAiC;YACjC,6BAA6B;YAC7B,kCAAkC;YAClC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,+BAA+B;YAC/B,EAAE,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;YAEjD,IAAI,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS;YAC7C,IAAI,WAAW,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,uBAAuB;YACzD,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC;YAC7B,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;YAC5B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YACnC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAC5B,WAAW,EACX,EAAE,CAAC,QAAQ,CAAC;gBAER,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,EAAE;oBAC7B,IAAM,SAAS,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;oBACzC,SAAS,CAAC,UAAU,CAAC,GAAG,aAAa,CAAC,GAAG,CAAC;oBAC1C,4DAA4D;gBAC/D,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CACL,CAAC,CAAC;YACH,8BAA8B;YAC9B,kDAAkD;SACrD;IAEL,CAAC;IAvOD;QADC,QAAQ,CAAC,qBAAW,CAAC;2CACS;IAG/B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;sCACI;IAGvB;QADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;wCACM;IAG5B;QADC,QAAQ;qCACc;IAGvB;QADC,QAAQ,CAAC,EAAC,IAAI,EAAC,EAAE,CAAC,SAAS,EAAC,CAAC;oCACL;IAGzB;QADC,QAAQ,CAAC,EAAC,IAAI,EAAC,EAAE,CAAC,SAAS,EAAC,CAAC;0CACC;IAG/B;QADC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC;0CACC;IArBL,GAAG;QADvB,OAAO;OACa,GAAG,CA2OvB;IAAD,UAAC;CA3OD,AA2OC,CA3OgC,EAAE,CAAC,SAAS,GA2O5C;kBA3OoB,GAAG","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\nimport GameManager from \"./gamemanager\";\r\nimport GlobalData from \"./GlobalData\";\r\n@ccclass\r\nexport default class Man extends cc.Component {\r\n\r\n    @property(GameManager)\r\n    Gamemanger: GameManager = null;\r\n\r\n    @property(cc.Label)\r\n    label: cc.Label = null;\r\n\r\n    @property(cc.TiledMap)\r\n    tilemap: cc.TiledMap = null;\r\n\r\n    @property\r\n    text: string = 'hello';\r\n\r\n    @property({type:cc.AudioClip})\r\n    bgm: cc.AudioClip = null;\r\n    \r\n    @property({type:cc.AudioClip})\r\n    goinSound: cc.AudioClip = null;\r\n\r\n    @property(cc.Integer)\r\n    moveSpeed: number = 1; // 移动速度，可以根据需要调整\r\n\r\n    animation= null; // 动画组件\r\n\r\n    private isBattle: boolean = false;\r\n\r\n    private isMovingUp: boolean = false;\r\n    private isMovingDown: boolean = false;\r\n    private isMovingLeft: boolean = false;\r\n    private isMovingRight: boolean = false;\r\n    private destroynum = 0;\r\n    public enemyNum = 0;\r\n\r\n\r\n    start(){\r\n        let tilemap = cc.find('Canvas/map3').getComponent(cc.TiledMap);\r\n        // let smoglayer = cc.find('Canvas/map3/smog');\r\n        \r\n        \r\n        // let tilemap = this.getComponent(cc.TiledMap);\r\n        // console.log(\"hi\",tilemap);\r\n        let tilemapsize = tilemap.getMapSize();\r\n        let layer = tilemap.getLayer('ground');\r\n        let layersize = layer.getLayerSize();\r\n        let smoglayer = tilemap.getLayer('smog');\r\n        smoglayer.node.active = true;\r\n        console.log(\"layersize.width\",layersize.width);\r\n        console.log(\"layersize.height\",layersize.height);\r\n        console.log(\"tilemapsize\",tilemapsize);\r\n        console.log(\"smoglayer\",smoglayer);\r\n        for(let i = 0; i < layersize.width; i++){\r\n            for(let j = 0; j < layersize.height; j++){\r\n                let tile = smoglayer.getTiledTileAt(i,j,true);\r\n                if(tile.gid!=0){\r\n                    // console.log(\"i:\", i);\r\n                    // console.log(\"j:\", j);\r\n                    tile.node.group = 'smog';\r\n                    let collider = tile.node.addComponent(cc.BoxCollider);\r\n                    collider.offset = cc.v2(tilemapsize.width/2-256,tilemapsize.height/2-256);\r\n                    collider.size = tilemapsize;\r\n                    // console.log(this.node.position);\r\n                    // console.log(\"collider\",collider);\r\n                }\r\n            }\r\n        }\r\n        let nodetodestory = cc.director.getScene()[\"nodeToDestroy\"];\r\n        console.log(\"nodeToDestroy in man:\", nodetodestory);\r\n        //if(this.node.getChildByName(nodetodestory) !== null){\r\n        //    this.node.destroy();\r\n        //}\r\n        cc.director.getScene().walk((node: cc.Node) => {\r\n            // Perform operations on each node\r\n            // Access node properties, call methods, etc.\r\n            if(GlobalData.nodeToDestroy.includes(node.name)){\r\n                node.destroy();\r\n            }\r\n        }, () => {\r\n            // This callback is invoked after visiting each node in the scene hierarchy\r\n            //console.log(\"Iteration complete\");\r\n        });\r\n        cc.audioEngine.playMusic(this.bgm, true);\r\n        this.Gamemanger = cc.find('Canvas/gamemanager').getComponent('gamemanager');\r\n        // console.log(this.Gamemanger);\r\n        this.Gamemanger.palse = false;\r\n    }\r\n\r\n    onLoad() {\r\n        // 注册键盘事件\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        var manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        this.animation = this.getComponent(cc.Animation);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        this.node.setPosition(GlobalData.PlayerPosX,GlobalData.PlayerPosY);\r\n        cc.director.getCollisionManager().enabled = true;\r\n        // cc.director.getCollisionManager().enabledDebugDraw = true;\r\n        \r\n    }\r\n\r\n    onDestroy() {\r\n        // 移除键盘事件监听\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n    }\r\n\r\n    playAnimation(animationName: string) {\r\n        if (this.animation && this.animation.getAnimationState(animationName).isPlaying) {\r\n            return;\r\n        }\r\n\r\n        this.animation.play(animationName);\r\n    }\r\n\r\n    stopAnimation(animationName: string) {\r\n        if (this.animation && this.animation.getAnimationState(animationName).isPlaying) {\r\n            this.animation.stop(animationName);\r\n        }\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.up:\r\n                this.isMovingUp = true;\r\n                break;\r\n            case cc.macro.KEY.down:\r\n                this.isMovingDown = true;\r\n                break;\r\n            case cc.macro.KEY.left:\r\n                this.isMovingLeft = true;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.isMovingRight = true;\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp(event: cc.Event.EventKeyboard) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.up:\r\n                this.isMovingUp = false;\r\n                 this.stopAnimation(\"man_up\");\r\n                break;\r\n            case cc.macro.KEY.down:\r\n                this.isMovingDown = false;\r\n                 this.stopAnimation(\"man_down\");\r\n                break;\r\n            case cc.macro.KEY.left:\r\n                this.isMovingLeft = false;\r\n                 this.stopAnimation(\"man_left\");\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.isMovingRight = false;\r\n                 this.stopAnimation(\"man_right\");\r\n                break;\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        // if ((this.node.x >= 48 && this.node.x <= 88) && (this.node.y >= 50 && this.node.y <= 86) && this.isBattle == false) {\r\n        //     let smoglayer = cc.find('Canvas/map3/smog');\r\n        //     smoglayer.active = false; // 迷霧消失\r\n        // }\r\n        //cc.log(this.node.x, this.node.y);\r\n        // 根据按键状态更新角色位置\r\n        if(this.Gamemanger.palse==false)\r\n        {\r\n            if (this.isMovingUp) {\r\n            this.node.y += (this.moveSpeed * dt);\r\n                if(!this.animation.getAnimationState(\"man_up\").isPlaying)this.animation.play(\"man_up\");\r\n            }\r\n            if (this.isMovingDown) {\r\n                this.node.y -= this.moveSpeed * dt;\r\n                if(!this.animation.getAnimationState(\"man_down\").isPlaying)this.animation.play(\"man_down\");\r\n            }\r\n            if (this.isMovingLeft) {\r\n                this.node.x -= this.moveSpeed * dt;\r\n                if(!this.animation.getAnimationState(\"man_left\").isPlaying)this.animation.play(\"man_left\");\r\n            }\r\n            if (this.isMovingRight) {\r\n                this.node.x += this.moveSpeed * dt;\r\n                if(!this.animation.getAnimationState(\"man_right\").isPlaying)this.animation.play(\"man_right\");\r\n            }\r\n        }\r\n        \r\n        if ((this.node.x >= 48 && this.node.x <= 88) && (this.node.y >= 50 && this.node.y <= 86) && this.isBattle == false) {\r\n        }   \r\n        GlobalData.PlayerPosX = this.node.getPosition().x;\r\n        GlobalData.PlayerPosY = this.node.getPosition().y;  \r\n        cc.audioEngine.setMusicVolume(GlobalData.volume);\r\n        cc.audioEngine.setEffectsVolume(GlobalData.volume);\r\n    }\r\n\r\n    onCollisionEnter(other, self) {\r\n        if(other.node.group == \"smog\"){\r\n            other.node.active = false; // 迷霧消失\r\n            other.node.getComponent(cc.TiledTile).gid=0;\r\n        }\r\n    }\r\n    onBeginContact(contact, selfCollider, otherCollider) {\r\n        //cc.log(\"Player hits the bush\");\r\n        let worldManifold = contact.getWorldManifold();\r\n        let points = worldManifold.points;\r\n        let normal = worldManifold.normal;\r\n        if(otherCollider.tag == 4 || otherCollider.tag == 5 || otherCollider.tag == 6|| otherCollider.tag == 7){\r\n            this.enemyNum = otherCollider.tag;\r\n            //console.log(\"enemyNum in man\");\r\n            //console.log(this.enemyNum);\r\n            //cc.log(\"Player hits the enemy\");\r\n            this.isBattle = true;\r\n            // cc.audioEngine.pauseMusic();\r\n            cc.audioEngine.playEffect(this.goinSound, false);\r\n        \r\n            var canvasNode = cc.find(\"Canvas\"); // 获取画布节点\r\n            var blinkAction = cc.blink(2, 5); // 闪烁动画，持续时间为2秒，闪烁次数为5次\r\n            this.Gamemanger.palse = true;\r\n            cc.audioEngine.pauseMusic();\r\n            console.log(this.Gamemanger.palse);\r\n            canvasNode.runAction(cc.sequence(\r\n                blinkAction,\r\n                cc.callFunc(function () {\r\n                       \r\n                    cc.director.loadScene(\"battle\", () =>{\r\n                       const nextScene = cc.director.getScene();\r\n                       nextScene[\"enemyNum\"] = otherCollider.tag;\r\n                       //console.log(\"nextScene[enemyNum]\", nextScene[\"enemyNum\"]);\r\n                    });\r\n                })\r\n            ));\r\n            //cc.audioEngine.pauseMusic();\r\n            //cc.audioEngine.playEffect(this.battleBgm, true);\r\n        }\r\n    \r\n    }\r\n}"]}